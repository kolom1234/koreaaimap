<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ì„œìš¸ ì‹¤ì‹œê°„ ë„ì‹œë°ì´í„° â€” ë°ëª¨</title>
  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root { --brand: linear-gradient(90deg,#6366f1 0%,#7c3aed 50%,#06b6d4 100%); }
    html,body{height:100%;background:#0b1020;color:#0f172a;font-family:Inter,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Apple SD Gothic Neo,Arial;}
    .glass { backdrop-filter:saturate(180%) blur(10px); background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.12); }
    .chip { padding:.35rem .65rem;border-radius:999px;border:1px solid rgba(255,255,255,.14); background:rgba(255,255,255,.06); font-size:.85rem; }
    .chip.active { border-color:rgba(99,102,241,.7); box-shadow:0 0 0 2px rgba(99,102,241,.25) inset; }
    .legend-dot{width:10px;height:10px;border-radius:999px;display:inline-block;margin-right:6px}
    .shadow-soft{box-shadow:0 10px 25px rgba(0,0,0,.25)}
    /* map */
    #map{height:62vh; border-radius:18px; overflow:hidden}
    .leaflet-control-container .leaflet-top.leaflet-left{margin-top:70px} /* avoid header */
    /* graceful scroll */
    *{scroll-behavior:smooth}
  </style>
  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <!-- Heatmap plugin -->
  <script src="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js"></script>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body class="text-slate-100">
  <!-- Header -->
  <header class="sticky top-0 z-40 shadow-soft" style="background:var(--brand)">
    <div class="max-w-6xl mx-auto px-5 py-3 flex flex-wrap items-center gap-3">
      <div class="flex items-center gap-3">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none"><path d="M12 2l9 4.5v10L12 21 3 16.5v-10L12 2Z" fill="white" opacity=".85"/></svg>
        <h1 class="text-lg md:text-xl font-semibold">ì„œìš¸ ì‹¤ì‹œê°„ ë„ì‹œë°ì´í„° Â· ë°ëª¨</h1>
      </div>
      <div class="ml-auto flex items-center gap-2">
        <!-- hotspot selector -->
        <label class="sr-only" for="hotspotSel">ê´€ì‹¬ ì§€ì—­</label>
        <select id="hotspotSel" class="glass rounded-xl px-3 py-2 text-sm text-white/90">
          <option>ì–´ë¦°ì´ëŒ€ê³µì›</option>
          <option>ì—¬ì˜ë„í•œê°•ê³µì›</option>
          <option>ì„œìš¸ìˆ²</option>
        </select>
        <div id="weatherChip" class="chip">â˜€ï¸ 28.6Â°C</div>
        <a href="#about" class="chip hover:bg-white/10">â„¹ï¸ ì•ˆë‚´</a>
      </div>
      <div class="w-full"></div>
      <!-- category chips -->
      <div class="flex gap-2 flex-wrap">
        <button data-layer="population" class="chip active">ğŸ‘¥ ì¸êµ¬</button>
        <button data-layer="congestion" class="chip active">ğŸŒ¡ í˜¼ì¡ë„(íˆíŠ¸)</button>
        <button data-layer="parking" class="chip">ğŸ…¿ï¸ ì£¼ì°¨</button>
        <button data-layer="cctv" class="chip">ğŸ“¹ CCTV</button>
        <button data-layer="bike" class="chip">ğŸš² ë”°ë¦‰ì´</button>
        <button data-layer="subway" class="chip">ğŸš‡ ì§€í•˜ì² </button>
      </div>
    </div>
  </header>

  <!-- Main -->
  <main class="max-w-6xl mx-auto px-4 pt-4 pb-24">
    <!-- map + side tools -->
    <section class="relative">
      <div id="map" class="shadow-soft"></div>

      <!-- Map style switch -->
      <div class="absolute top-4 right-4 glass rounded-xl p-2 flex flex-col gap-2">
        <span class="text-xs text-white/70 px-2 pt-1">ì§€ë„ ìŠ¤íƒ€ì¼</span>
        <button class="chip" data-style="auto">ìë™</button>
        <button class="chip" data-style="dark">ì•¼ê°„</button>
        <button class="chip" data-style="gray">í‘ë°±</button>
      </div>

      <!-- mini legend -->
      <div class="absolute bottom-4 right-4 glass rounded-xl p-3 text-xs">
        <div class="mb-1 font-semibold text-white/90">í˜¼ì¡ë„ ë ˆì „ë“œ</div>
        <div><span class="legend-dot" style="background:#22c55e"></span>ì—¬ìœ </div>
        <div><span class="legend-dot" style="background:#f59e0b"></span>ë³´í†µ</div>
        <div><span class="legend-dot" style="background:#ef4444"></span>ë¶ë¹”</div>
      </div>
    </section>

    <!-- info panel -->
    <section class="mt-6 grid md:grid-cols-3 gap-4">
      <!-- big card -->
      <article class="md:col-span-2 glass rounded-2xl p-5">
        <div class="flex flex-wrap items-end gap-3">
          <h2 id="titleNow" class="text-xl font-bold">ì§€ê¸ˆ ì–´ë¦°ì´ëŒ€ê³µì›ì€</h2>
          <span id="statusBadge" class="chip">ë³´í†µ</span>
          <span id="updatedAt" class="text-white/60 text-sm">â€”</span>
        </div>
        <div class="grid sm:grid-cols-3 gap-4 mt-4">
          <div class="glass rounded-xl p-4">
            <div class="text-sm text-white/60">ì‹¤ì‹œê°„ ì¸êµ¬(ì¶”ì •)</div>
            <div id="peopleNow" class="text-2xl font-bold mt-1">â€”</div>
            <div id="stayTime" class="text-white/60 text-sm mt-1">ì˜ˆìƒ ì²´ë¥˜ 2ì‹œê°„</div>
          </div>
          <div class="glass rounded-xl p-4">
            <div class="text-sm text-white/60">í˜¼ì¡ ì§€ìˆ˜</div>
            <div id="congestionScore" class="text-2xl font-bold mt-1">â€”</div>
            <div id="changeRate" class="text-white/60 text-sm mt-1">ì „ì¼ ëŒ€ë¹„ â€”</div>
          </div>
          <div class="glass rounded-xl p-4">
            <div class="text-sm text-white/60">êµí†µ ì†ë„</div>
            <div id="trafficSpeed" class="text-2xl font-bold mt-1">â€”</div>
            <div class="text-white/60 text-sm mt-1">ëŒ€ì¤‘êµí†µ/ì°¨/ë„ë³´ í‰ê· </div>
          </div>
        </div>

        <div class="mt-6">
          <canvas id="chart" height="120"></canvas>
          <div class="text-white/60 text-xs mt-2">â€» ë³¸ í™”ë©´ì€ ë°ëª¨ë¡œ, ë°ì´í„°ëŠ” ëª¨ì˜ ê°’ì…ë‹ˆë‹¤.</div>
        </div>
      </article>

      <!-- details -->
      <aside class="glass rounded-2xl p-5">
        <h3 class="font-semibold text-lg mb-3">ì£¼ìš” ì§€ì </h3>
        <ul id="poiList" class="space-y-2 text-sm"></ul>
        <hr class="border-white/10 my-4">
        <h3 class="font-semibold text-lg mb-3">í•„í„°</h3>
        <div class="flex flex-wrap gap-2">
          <span class="chip">ê°€ì¡±ì¹œí™”</span>
          <span class="chip">í”¼í¬ë‹‰</span>
          <span class="chip">ë°˜ë ¤ë™ë¬¼</span>
          <span class="chip">ì•¼ì™¸</span>
        </div>
      </aside>
    </section>

    <!-- about -->
    <section id="about" class="mt-10 glass rounded-2xl p-5">
      <h3 class="font-semibold text-lg mb-2">ì•ˆë‚´</h3>
      <p class="text-white/80 text-sm leading-6">
        ì´ í˜ì´ì§€ëŠ” <b>ì„œìš¸ì‹œ ì‹¤ì‹œê°„ ë„ì‹œë°ì´í„°</b> ìŠ¤íƒ€ì¼ì„ ëª¨ì‚¬í•œ <b>ì„ì‹œ ë°ëª¨</b>ì…ë‹ˆë‹¤.
        ì§€ë„/ì°¨íŠ¸ëŠ” ê³µê°œ ë¼ì´ë¸ŒëŸ¬ë¦¬(Leaflet, Chart.js)ë¥¼ ì‚¬ìš©í–ˆê³ , ë°ì´í„°ëŠ” ëª¨ì˜ ê°’ì…ë‹ˆë‹¤.
        ì‹¤ì œ ì—°ê³„ ì‹œ ì„œìš¸ì‹œ ì˜¤í”ˆ APIì˜ ì‘ë‹µì„ <code>hotspots</code>ì— ë§¤í•‘í•  ì˜ˆì •ì…ë‹ˆë‹¤.
      </p>
    </section>
  </main>

  <script>
    // -------- Mock data (í•«ìŠ¤íŒŸ ì •ì˜) ----------
    const hotspots = {
      "ì–´ë¦°ì´ëŒ€ê³µì›": {
        center: [37.5483, 127.0792],
        circleRadius: 450,
        persons: 5200,                    // ì‹¤ì‹œê°„ ì¸êµ¬(ì¶”ì •)
        congestion: 68,                   // 0~100
        changeRate: +16.1,                // ì „ì¼ ëŒ€ë¹„
        traffic: 18,                      // km/h
        weather: "â˜€ï¸ 28.6Â°C",
        poi: [
          { name: "ë‚¨ë¬¸", coord: [37.5489,127.0826], type: "gate" },
          { name: "ì§€í•˜ì²  7í˜¸ì„  ì–´ë¦°ì´ëŒ€ê³µì›(6ë²ˆì¶œêµ¬)", coord: [37.5481,127.0742], type: "subway" },
          { name: "ì£¼ì°¨ì¥", coord: [37.5472,127.0749], type: "parking" },
          { name: "ë”°ë¦‰ì´ ëŒ€ì—¬ì†Œ", coord: [37.5477,127.0799], type: "bike" }
        ],
        heat: [
          [37.5489,127.0820,0.8],[37.5468,127.0785,0.6],[37.5502,127.0782,0.5],
          [37.5475,127.0810,0.7],[37.5482,127.0790,0.9]
        ],
        hourly: [35,42,40,38,45,52,60,70,72,68,65,61,58,56,60,64,70,74,78,80,76,69,58,44]
      },
      "ì—¬ì˜ë„í•œê°•ê³µì›": {
        center: [37.5261,126.9315],
        circleRadius: 650,
        persons: 7800,
        congestion: 82,
        changeRate: +8.3,
        traffic: 22,
        weather: "ğŸŒ¤ 27.1Â°C",
        poi: [
          { name: "ì—¬ì˜ë‚˜ë£¨ì—­ 2ë²ˆì¶œêµ¬", coord: [37.5271,126.9328], type: "subway" },
          { name: "ì£¼ì°¨ì¥ P3", coord: [37.5278,126.9347], type: "parking" },
          { name: "ë”°ë¦‰ì´ ì—¬ì˜ë‚˜ë£¨", coord: [37.5257,126.9336], type: "bike" }
        ],
        heat: [
          [37.5266,126.9342,0.8],[37.5238,126.9305,0.6],[37.5271,126.9289,0.5],
          [37.5262,126.9331,0.9],[37.5251,126.9318,0.7]
        ],
        hourly: [22,20,18,17,19,24,33,45,58,70,78,82,80,76,74,72,68,66,70,75,71,60,42,28]
      },
      "ì„œìš¸ìˆ²": {
        center: [37.5446,127.0378],
        circleRadius: 520,
        persons: 4100,
        congestion: 55,
        changeRate: -3.2,
        traffic: 17,
        weather: "â›…ï¸ 26.9Â°C",
        poi: [
          { name: "ì„œìš¸ìˆ²ì—­ 3ë²ˆì¶œêµ¬", coord: [37.5442,127.0447], type: "subway" },
          { name: "ì£¼ì°¨ì¥", coord: [37.5439,127.0356], type: "parking" },
          { name: "ë”°ë¦‰ì´ ì„œìš¸ìˆ²", coord: [37.5437,127.0387], type: "bike" }
        ],
        heat: [
          [37.5455,127.0386,0.7],[37.5448,127.0399,0.65],[37.5432,127.0366,0.55],
          [37.5449,127.0372,0.8],[37.5462,127.0378,0.5]
        ],
        hourly: [15,13,12,12,15,22,31,42,50,55,57,59,60,58,56,54,53,51,50,52,55,48,35,20]
      }
    };

    // --------- Leaflet map ----------
    const map = L.map('map',{zoomControl:true, scrollWheelZoom:true});
    const tilesAuto = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
      maxZoom: 19, attribution: '&copy; OpenStreetMap'
    });
    const tilesGray = L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png',{
      maxZoom: 20, attribution: '&copy; OSM & CARTO'
    });
    const tilesDark = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png',{
      maxZoom: 20, attribution: '&copy; OSM & CARTO'
    });
    tilesAuto.addTo(map);

    const layers = {
      population: L.layerGroup().addTo(map),
      congestion: L.layerGroup().addTo(map),
      parking: L.layerGroup(),
      cctv: L.layerGroup(),
      bike: L.layerGroup(),
      subway: L.layerGroup()
    };

    const icons = {
      parking: L.divIcon({html:'<div class="chip">ğŸ…¿ï¸</div>',className:'',iconSize:[24,24]}),
      bike: L.divIcon({html:'<div class="chip">ğŸš²</div>',className:'',iconSize:[24,24]}),
      cctv: L.divIcon({html:'<div class="chip">ğŸ“¹</div>',className:'',iconSize:[24,24]}),
      subway: L.divIcon({html:'<div class="chip">ğŸš‡</div>',className:'',iconSize:[24,24]}),
      gate:   L.divIcon({html:'<div class="chip">ğŸšª</div>',className:'',iconSize:[24,24]})
    };

    let heatLayer = null;
    let areaCircle = null;

    // --------- Chart ----------
    const ctx = document.getElementById('chart');
    const chart = new Chart(ctx, {
      type:'bar',
      data:{ labels:[...Array(24).keys()].map(h=>`${h}ì‹œ`), datasets:[{label:'ì‹œê°„ëŒ€ ì¸êµ¬/í˜¼ì¡ë„(ì§€ìˆ˜)', data:[], borderWidth:0}]},
      options:{
        responsive:true, maintainAspectRatio:false,
        scales:{ y:{ beginAtZero:true, grid:{color:'rgba(255,255,255,.08)'}, ticks:{color:'rgba(255,255,255,.8)'}},
                 x:{ grid:{display:false}, ticks:{color:'rgba(255,255,255,.7)'}}},
        plugins:{ legend:{labels:{color:'rgba(255,255,255,.8)'}}, tooltip:{mode:'index',intersect:false} }
      }
    });

    // --------- UI control ----------
    const $ = (sel)=>document.querySelector(sel);
    const hotspotSel = $('#hotspotSel');

    function fmt(n){ return n.toLocaleString('ko-KR'); }
    function statusFrom(score){
      if(score>=75) return {label:'ë¶ë¹”', color:'#ef4444'};
      if(score>=55) return {label:'ì•½ê°„ ë¶ë¹”', color:'#f59e0b'};
      return {label:'ë³´í†µ', color:'#22c55e'};
    }

    function renderHotspot(name){
      const h = hotspots[name];
      // header chips
      $('#weatherChip').textContent = h.weather;
      $('#titleNow').textContent = `ì§€ê¸ˆ ${name}ì€`;

      // map view
      map.setView(h.center, 15);

      // clear layers
      Object.values(layers).forEach(g=>g.clearLayers());
      if(heatLayer) map.removeLayer(heatLayer);
      if(areaCircle) map.removeLayer(areaCircle);

      // area circle (population area)
      areaCircle = L.circle(h.center, {radius:h.circleRadius, color:'#7c3aed', weight:2, fill:true, fillOpacity:.08}).addTo(layers.population);

      // heat
      heatLayer = L.heatLayer(h.heat,{radius:45, blur:30, maxZoom:16, gradient:{0.2:'#22c55e',0.5:'#f59e0b',0.8:'#ef4444'}}).addTo(layers.congestion);

      // POIs
      h.poi.forEach(p=>{
        L.marker(p.coord,{icon:icons[p.type]||icons.gate}).addTo(layers[p.type]||layers.population)
          .bindTooltip(p.name,{direction:'top',offset:[0,-10]});
      });

      // right panel list
      const ul = $('#poiList'); ul.innerHTML='';
      h.poi.forEach(p=>{
        const li = document.createElement('li');
        li.innerHTML = `<div class="glass rounded-lg px-3 py-2 flex justify-between"><span>${p.name}</span><span class="opacity-70">${iconEmoji(p.type)}</span></div>`;
        ul.appendChild(li);
      });

      // stats
      $('#peopleNow').textContent = fmt(h.persons);
      $('#congestionScore').textContent = `${h.congestion} / 100`;
      $('#changeRate').textContent = `${(h.changeRate>0?'+':'')}${h.changeRate}%`;
      $('#trafficSpeed').textContent = `${h.traffic} km/h`;
      const st = statusFrom(h.congestion);
      const badge = $('#statusBadge');
      badge.textContent = st.label;
      badge.style.background = 'rgba(255,255,255,.06)';
      badge.style.borderColor = st.color;
      badge.style.boxShadow = `0 0 0 2px ${hexToRGBA(st.color,.3)} inset`;

      // chart
      chart.data.datasets[0].data = h.hourly;
      chart.update();

      // updated at
      const now = new Date();
      $('#updatedAt').textContent = now.toLocaleString('ko-KR') + ' ê¸°ì¤€';
    }

    function iconEmoji(type){
      return {parking:'ğŸ…¿ï¸', bike:'ğŸš²', cctv:'ğŸ“¹', subway:'ğŸš‡', gate:'ğŸšª'}[type] || 'ğŸ“';
    }
    function hexToRGBA(hex,a=1){ const h=hex.replace('#',''); const bigint=parseInt(h,16);
      const r=(bigint>>16)&255,g=(bigint>>8)&255,b=bigint&255; return `rgba(${r},${g},${b},${a})`; }

    // category toggles
    document.querySelectorAll('button[data-layer]').forEach(btn=>{
      btn.addEventListener('click',()=>{
        const key = btn.dataset.layer;
        const grp = (key==='congestion') ? heatLayer : layers[key];
        const on = btn.classList.toggle('active');
        if(key==='congestion'){
          if(on) heatLayer.addTo(map); else map.removeLayer(heatLayer);
        }else{
          if(on) grp.addTo(map); else map.removeLayer(grp);
        }
      });
    });

    // style switch
    document.querySelectorAll('button[data-style]').forEach(btn=>{
      btn.addEventListener('click',()=>{
        const v = btn.dataset.style;
        [tilesAuto,tilesGray,tilesDark].forEach(t=>map.removeLayer(t));
        if(v==='dark') tilesDark.addTo(map);
        else if(v==='gray') tilesGray.addTo(map);
        else tilesAuto.addTo(map);
      });
    });

    hotspotSel.addEventListener('change', e=> renderHotspot(e.target.value));
    renderHotspot(hotspotSel.value);
  </script>
</body>
</html>
